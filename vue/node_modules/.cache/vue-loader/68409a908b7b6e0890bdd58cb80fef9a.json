{"remainingRequest":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\src\\views\\code.vue?vue&type=style&index=0&id=67f13e87&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\src\\views\\code.vue","mtime":1744246218213},{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1735803514000},{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1735803516000},{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1735803516000},{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1735803514000},{"path":"C:\\Users\\86186\\Desktop\\SmartFarm\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1735803516000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucXJjb2RlLWNvbnRhaW5lciB7DQogICAgd2lkdGg6IDIwMHB4Ow0KICAgIGhlaWdodDogMjAwcHg7DQogICAgbWFyZ2luOiAwIGF1dG87DQp9DQouZmFkZS1pbiB7DQogICAgYW5pbWF0aW9uOiBmYWRlSW4gMC41cyBlYXNlLWluLW91dDsNCn0NCkBrZXlmcmFtZXMgZmFkZUluIHsNCiAgICBmcm9tIHsgb3BhY2l0eTogMDsgfQ0KICAgIHRvIHsgb3BhY2l0eTogMTsgfQ0KfQ0KLmJnLXBhdHRlcm4gew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmMGY4ZjA7DQogICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHJnYmEoMTQ0LCAyMzgsIDE0NCwgMC4xKSAxcHgsIHRyYW5zcGFyZW50IDFweCksDQogICAgICAgICAgICAgICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgxNDQsIDIzOCwgMTQ0LCAwLjEpIDFweCwgdHJhbnNwYXJlbnQgMXB4KTsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IDIwcHggMjBweDsNCn0NCi51cGxvYWQtaW5wdXQgew0KICAgIHdpZHRoOiAwLjFweDsNCiAgICBoZWlnaHQ6IDAuMXB4Ow0KICAgIG9wYWNpdHk6IDA7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogLTE7DQp9DQo="},{"version":3,"sources":["code.vue"],"names":[],"mappings":";AAiWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"code.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n<div class=\"container mx-auto px-4 py-8 bg-gray-50\">\r\n    <!-- 导航栏 -->\r\n    <nav class=\"bg-white shadow-md p-4 rounded-lg mb-8\">\r\n        <div class=\"container mx-auto flex justify-between items-center\">\r\n            <div class=\"flex items-center\">\r\n                <span class=\"text-xl font-bold text-green-700\">智慧农场溯源系统</span>\r\n            </div>\r\n            <div class=\"flex space-x-4\">\r\n                <router-link to=\"/\" class=\"text-green-600 hover:text-green-800\">返回首页</router-link>\r\n            </div>\r\n        </div>\r\n    </nav>\r\n    \r\n    <!-- 批量生成部分 -->\r\n    <div class=\"batch-section bg-white rounded-lg shadow-md p-6 mb-8\">\r\n        <div class=\"text-center mb-4\">\r\n            <svg class=\"mx-auto h-12 w-12 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"/>\r\n            </svg>\r\n            <h3 class=\"mt-2 text-lg font-semibold text-gray-800\">批量生成农作物溯源码</h3>\r\n            <p class=\"mt-1 text-sm text-gray-500\">请上传包含农作物信息的Excel文件（支持.xlsx格式）</p>\r\n            <p class=\"text-xs text-gray-400 mt-2\">文件应包含：产品名称、种植地点、种植时间等必要字段</p>\r\n        </div>\r\n        <div class=\"flex flex-col items-center space-y-4\">\r\n            <label class=\"w-full cursor-pointer\">\r\n                <input type=\"file\" @change=\"handleExcelUpload\" accept=\".xlsx\" \r\n                    class=\"upload-input opacity-0 absolute z-0\">\r\n                <div class=\"bg-green-50 text-green-700 hover:bg-green-100 px-6 py-3 rounded-md border-2 border-dashed border-green-200 \r\n                    transition-colors duration-200 w-full text-center flex items-center justify-center\">\r\n                    <span class=\"mr-2\">选择Excel文件</span>\r\n                    <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path d=\"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\"/>\r\n                    </svg>\r\n                </div>\r\n            </label>\r\n            <button @click=\"downloadBatchQRCodes\" :disabled=\"!batchCodes.length\" \r\n                class=\"download-btn bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-md \r\n                transition-colors duration-300 flex items-center disabled:opacity-50 disabled:cursor-not-allowed\">\r\n                <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/>\r\n                </svg>\r\n                打包下载全部二维码\r\n            </button>\r\n        </div>\r\n    </div>\r\n    \r\n    <!-- 主要内容 -->\r\n    <div class=\"main-content\">\r\n        <!-- 生成溯源码部分 -->\r\n        <div class=\"bg-white rounded-lg shadow-md p-8 mb-8\">\r\n                    <h2 class=\"text-2xl font-bold text-center text-green-700 mb-6\">生成农产品溯源码</h2>\r\n                    <div class=\"space-y-6\">\r\n                        <div class=\"grid grid-cols-1 gap-4 md:grid-cols-2\">\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">产品名称 <span class=\"text-red-500\">*</span></label>\r\n                                <input v-model=\"product.name\" type=\"text\" class=\"border p-2 rounded-md\" placeholder=\"请输入产品名称\">\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">种植地点</label>\r\n                                <input v-model=\"product.location\" type=\"text\" class=\"border p-2 rounded-md\" placeholder=\"请输入种植地点\">\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">种植时间</label>\r\n                                <input v-model=\"product.plantingDate\" type=\"date\" class=\"border p-2 rounded-md\">\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">收获时间</label>\r\n                                <input v-model=\"product.harvestDate\" type=\"date\" class=\"border p-2 rounded-md\">\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">施肥记录</label>\r\n                                <textarea v-model=\"product.fertilizer\" class=\"border p-2 rounded-md\" rows=\"3\" placeholder=\"请输入施肥记录\"></textarea>\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">农药使用</label>\r\n                                <textarea v-model=\"product.pesticide\" class=\"border p-2 rounded-md\" rows=\"3\" placeholder=\"请输入农药使用情况\"></textarea>\r\n                            </div>\r\n                            <div class=\"flex flex-col space-y-2\">\r\n                                <label class=\"text-gray-700\">电话号码</label>\r\n                                <textarea v-model=\"product.number\" class=\"border p-2 rounded-md\" rows=\"3\" placeholder=\"请输入产品农户电话号码\"></textarea>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"flex justify-center mt-4\">\r\n                            <button @click=\"generateQRCode\" \r\n                                :disabled=\"isGenerating || !product.name\" \r\n                                class=\"bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50\"\r\n                                :class=\"{'opacity-50 cursor-not-allowed': isGenerating || !product.name}\">\r\n                                <span v-if=\"isGenerating\" class=\"flex items-center\">\r\n                                    <svg class=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                                        <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                                        <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                                    </svg>\r\n                                    生成中...\r\n                                </span>\r\n                                <span v-else>生成溯源码</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- 溯源码展示部分 -->\r\n                <!-- 隐藏的二维码容器，用于生成二维码 -->\r\n                <div id=\"qrcode-container\" style=\"display: none;\"></div>\r\n                \r\n                <div v-if=\"qrCode\" class=\"bg-white rounded-lg shadow-md p-8 fade-in\">\r\n                    <h2 class=\"text-2xl font-bold text-center text-green-700 mb-6\">溯源码信息</h2>\r\n                    <div class=\"flex flex-col md:flex-row items-center md:items-start md:space-x-8\">\r\n                        <div class=\"qrcode-container\">\r\n                            <img :src=\"qrCode\" alt=\"溯源码\" class=\"w-full h-full object-contain\">\r\n                        </div>\r\n                        <div class=\"flex-1\">\r\n                            <div class=\"bg-green-50 p-4 rounded-lg border-l-4 border-green-500 mb-4\">\r\n                                <h3 class=\"text-lg font-semibold text-green-700 mb-2\">产品基本信息</h3>\r\n                                <div class=\"space-y-2\">\r\n                                    <p><span class=\"font-medium text-gray-600\">产品名称:</span> <span class=\"text-gray-800\">{{ product.name }}</span></p>\r\n                                    <p v-if=\"product.location\"><span class=\"font-medium text-gray-600\">种植地点:</span> <span class=\"text-gray-800\">{{ product.location }}</span></p>\r\n                                </div>\r\n                            </div>\r\n                            \r\n                            <div class=\"bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 mb-4\">\r\n                                <h3 class=\"text-lg font-semibold text-blue-700 mb-2\">时间信息</h3>\r\n                                <div class=\"space-y-2\">\r\n                                    <p v-if=\"product.plantingDate\"><span class=\"font-medium text-gray-600\">种植时间:</span> <span class=\"text-gray-800\">{{ formatDate(product.plantingDate) }}</span></p>\r\n                                    <p v-if=\"product.harvestDate\"><span class=\"font-medium text-gray-600\">收获时间:</span> <span class=\"text-gray-800\">{{ formatDate(product.harvestDate) }}</span></p>\r\n                                </div>\r\n                            </div>\r\n                            \r\n                            <div v-if=\"product.fertilizer\" class=\"bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500 mb-4\">\r\n                                <h3 class=\"text-lg font-semibold text-yellow-700 mb-2\">施肥记录</h3>\r\n                                <p class=\"text-gray-700 whitespace-pre-line\">{{ product.fertilizer }}</p>\r\n                            </div>\r\n                            \r\n                            <div v-if=\"product.pesticide\" class=\"bg-red-50 p-4 rounded-lg border-l-4 border-red-500\">\r\n                                <h3 class=\"text-lg font-semibold text-red-700 mb-2\">农药使用</h3>\r\n                                <p class=\"text-gray-700 whitespace-pre-line\">{{ product.pesticide }}</p>\r\n                            </div>\r\n                            <div v-if=\"product.number\" class=\"bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500\">\r\n                                <h3 class=\"text-lg font-semibold text-purple-700 mb-2\">电话号码</h3>\r\n                                <p class=\"text-gray-700 whitespace-pre-line\">{{ product.number }}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div class=\"mt-6 text-center\">\r\n                        <p class=\"text-sm text-gray-500 mb-2\">扫描上方二维码查看详细溯源信息</p>\r\n                        <button @click=\"resetForm\" class=\"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors duration-300 mr-2\">\r\n                            重新生成\r\n                        </button>\r\n                        <button @click=\"downloadQRCode\" class=\"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors duration-300 mr-2\">\r\n                            <svg class=\"w-4 h-4 inline-block mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/>\r\n                            </svg>\r\n                            下载二维码\r\n                        </button>\r\n                        <a :href=\"detailPageUrl\" target=\"_blank\" class=\"inline-block bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors duration-300\">\r\n                            查看详情页\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 页脚 -->\r\n        <footer class=\"bg-green-800 text-white p-8 mt-8 rounded-lg\">\r\n            <div class=\"container mx-auto px-4\">\r\n                <div class=\"flex flex-col md:flex-row justify-between items-center\">\r\n                    <div>\r\n                        <h3 class=\"text-xl font-bold\">智慧农场溯源系统</h3>\r\n                        <p>科技赋能农业，智慧创造未来</p>\r\n                    </div>\r\n                    <div class=\"mt-4 md:mt-0\">\r\n                        <p>公司网站: <a href=\"http://www.hl3344.space\" target=\"_blank\" class=\"underline\">www.hl3344.space</a></p>\r\n                        <p>联系电话: 1862483344</p>\r\n                    </div>\r\n                </div>\r\n                <div class=\"mt-8 text-center\">\r\n                    <p>© 2025 智慧农场溯源系统. All rights reserved.</p>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: 'CodeView',\r\n    data() {\r\n        return {\r\n            baseUrl: 'https://d90c-117-160-30-35.ngrok-free.app',\r\n            product: {\r\n                name: '',\r\n                location: '',\r\n                plantingDate: '',\r\n                harvestDate: '',\r\n                fertilizer: '',\r\n                pesticide: '',\r\n                number: ''\r\n            },\r\n            qrCode: '',\r\n            batchCodes: [],\r\n            isGenerating: false,\r\n            detailPageUrl: '',\r\n            qrCodeInstance: null\r\n        };\r\n    },\r\n    methods: {\r\n        async generateQRCode() {\r\n            if (!this.product.name) {\r\n                alert('请输入产品名称');\r\n                return;\r\n            }\r\n            try {\r\n                this.isGenerating = true;\r\n                \r\n                const productData = {\r\n                    productName: this.product.name,\r\n                    location: this.product.location,\r\n                    plantingDate: this.product.plantingDate,\r\n                    harvestDate: this.product.harvestDate,\r\n                    fertilizer: this.product.fertilizer,\r\n                    pesticide: this.product.pesticide,\r\n                    number: this.product.number,\r\n                    contact: this.product.number,\r\n                    companyWebsite: 'http://www.hl3344.space'\r\n                };\r\n                \r\n                const encodedData = encodeURIComponent(JSON.stringify(productData));\r\n                this.detailPageUrl = `${this.baseUrl}/product-detail.html?data=${encodedData}`;\r\n                \r\n                const qrcodeContainer = document.getElementById('qrcode-container');\r\n                if (!qrcodeContainer) {\r\n                    throw new Error('无法找到二维码容器元素');\r\n                }\r\n                qrcodeContainer.innerHTML = '';\r\n                \r\n                await new Promise((resolve) => {\r\n                    this.qrCodeInstance = new QRCode(qrcodeContainer, {\r\n                        text: this.detailPageUrl,\r\n                        width: 200,\r\n                        height: 200,\r\n                        colorDark: '#000000',\r\n                        colorLight: '#ffffff',\r\n                        correctLevel: QRCode.CorrectLevel.H\r\n                    });\r\n                    \r\n                    setTimeout(resolve, 100);\r\n                });\r\n                \r\n                if (this.qrCodeInstance && this.qrCodeInstance._el) {\r\n                    const qrImage = this.qrCodeInstance._el.querySelector('img');\r\n                    if (qrImage) {\r\n                        this.qrCode = qrImage.src;\r\n                    } else {\r\n                        throw new Error('二维码图片生成失败');\r\n                    }\r\n                } else {\r\n                    throw new Error('二维码实例创建失败');\r\n                }\r\n            } catch (error) {\r\n                console.error('生成二维码出错:', error);\r\n                alert(`生成二维码出错: ${error.message}`);\r\n                this.qrCode = null;\r\n            } finally {\r\n                this.isGenerating = false;\r\n            }\r\n        },\r\n        handleExcelUpload(e) {\r\n            const file = e.target.files[0];\r\n            if (!file) return;\r\n\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                try {\r\n                    const data = new Uint8Array(e.target.result);\r\n                    const workbook = XLSX.read(data, {type: 'array'});\r\n                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];\r\n                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);\r\n                    \r\n                    this.batchCodes = jsonData.map(item => ({\r\n                        code: item.溯源码 || '',\r\n                        name: item.产品名称 || '未命名'\r\n                    }));\r\n                } catch (error) {\r\n                    console.error('Excel解析失败:', error);\r\n                    alert('文件解析失败，请检查文件格式');\r\n                }\r\n            };\r\n            reader.readAsArrayBuffer(file);\r\n        },\r\n        async downloadBatchQRCodes() {\r\n            if (!this.batchCodes.length) return;\r\n\r\n            try {\r\n                const zip = new JSZip();\r\n                const imgFolder = zip.folder('qrcodes');\r\n\r\n                await Promise.all(this.batchCodes.map(async (item) => {\r\n                    const response = await fetch(`${this.baseUrl}/qrcode?text=${encodeURIComponent(item.code)}&size=300x300`);\r\n                    const blob = await response.blob();\r\n                    imgFolder.file(`${item.name}.png`, blob);\r\n                }));\r\n\r\n                const content = await zip.generateAsync({type: 'blob'});\r\n                const link = document.createElement('a');\r\n                link.href = URL.createObjectURL(content);\r\n                link.download = '溯源码.zip';\r\n                link.click();\r\n            } catch (error) {\r\n                console.error('下载二维码出错:', error);\r\n                alert('下载二维码失败，请稍后重试');\r\n            }\r\n        },\r\n        resetForm() {\r\n            this.product = {\r\n                name: '',\r\n                location: '',\r\n                plantingDate: '',\r\n                harvestDate: '',\r\n                fertilizer: '',\r\n                pesticide: '',\r\n                number: ''\r\n            };\r\n            this.qrCode = '';\r\n            this.detailPageUrl = '';\r\n            if (this.qrCodeInstance) {\r\n                this.qrCodeInstance._el.innerHTML = '';\r\n            }\r\n        },\r\n        downloadQRCode() {\r\n            if (!this.qrCode) return;\r\n            \r\n            const link = document.createElement('a');\r\n            link.href = this.qrCode;\r\n            link.download = `${this.product.name}_溯源码.png`;\r\n            link.click();\r\n        },\r\n        formatDate(dateString) {\r\n            if (!dateString) return '未设置';\r\n            \r\n            const date = new Date(dateString);\r\n            if (isNaN(date.getTime())) return dateString;\r\n            \r\n            return date.toLocaleDateString('zh-CN', {\r\n                year: 'numeric',\r\n                month: 'long',\r\n                day: 'numeric'\r\n            });\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.qrcode-container {\r\n    width: 200px;\r\n    height: 200px;\r\n    margin: 0 auto;\r\n}\r\n.fade-in {\r\n    animation: fadeIn 0.5s ease-in-out;\r\n}\r\n@keyframes fadeIn {\r\n    from { opacity: 0; }\r\n    to { opacity: 1; }\r\n}\r\n.bg-pattern {\r\n    background-color: #f0f8f0;\r\n    background-image: linear-gradient(rgba(144, 238, 144, 0.1) 1px, transparent 1px),\r\n                    linear-gradient(90deg, rgba(144, 238, 144, 0.1) 1px, transparent 1px);\r\n    background-size: 20px 20px;\r\n}\r\n.upload-input {\r\n    width: 0.1px;\r\n    height: 0.1px;\r\n    opacity: 0;\r\n    overflow: hidden;\r\n    position: absolute;\r\n    z-index: -1;\r\n}\r\n</style>"]}]}